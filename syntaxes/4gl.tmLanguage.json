{
    "name": "Lenguaje 4GL Informix",
    "scopeName": "source.4gl",
    "patterns": [{ "include": "#4gl" }],
    "repository": {
        "4gl": {
            "patterns": [
                { "include": "#main" },
                { "include": "#functions" },
                { "include": "#keywords" },
                { "include": "#function_references" },
                { "include": "#comments" },
                { "include": "#string_escape" },
                { "include": "#string_interpolation" },
                { "include": "#strings" }
            ]
        },

        "main": {
            "name": "meta.main.4gl",
            "begin": "\\b(?i:(main))\\b",
            "beginCaptures": {
                "1": { "name": "storage.type.function.4gl" }
            },
            "end": "\\b(?i:end\\s+main)\\b",
            "endCaptures": {
                "0": { "name": "storage.type.main.4gl" }
            },
            "patterns": [{ "include": "#4gl" }]
        },

        "functions": {
            "name": "meta.function.4gl",
            "begin": "\\b(?i:(function|report))\\s+([A-Za-z_][A-Za-z0-9_]*)\\s*\\(([^)]*)\\)",
            "beginCaptures": {
                "1": { "name": "storage.type.function.4gl" },
                "2": { "name": "entity.name.function.4gl" },
                "3": { "name": "variable.parameter.function.4gl" }
            },
            "end": "\\b(?i:(end function|end report))\\b",
            "endCaptures": {
                "1": { "name": "keyword.control.4gl" },
                "2": { "name": "storage.type.function.4gl" }
            },
            "patterns": [{ "include": "#4gl" }]
        },

        "keywords": {
            "patterns": [
                {
                    "comment": "Tipos compuestos: ARRAY OF RECORD",
                    "patterns": [
                        {
                            "match": "\\b(?i:ARRAY)\\b",
                            "name": "storage.type.array.4gl"
                        },
                        {
                            "match": "\\[(\\d+)\\]",
                            "name": "constant.numeric.array-size.4gl"
                        },
                        {
                            "match": "\\b(?i:OF)\\b",
                            "name": "keyword.operator.of.4gl"
                        },
                        {
                            "match": "\\b(?i:RECORD)\\b",
                            "name": "storage.type.record.4gl"
                        }
                    ]
                },
                {
                    "comment": "Bloques o funciones en bloque y similares",
                    "match": "\\b(?i:(call|returning|menu|if not|end foreach|end while|end case|end for|end if|start report|finish report|otherwise|elseif|foreach|while|return|case|when|then|else|for|if|exit program|end menu))\\b",
                    "name": "keyword.control.block.4gl"
                },
                {
                    "comment": "Data Types",
                    "name": "storage.type.source.4gl",
                    "match": "\\b(?i:(time|today|true|false|CHAR|CHAR NOT NULL|SMALLINT|SMALLINT NOT NULL|INTEGER|INTEGER NOT NULL|FLOAT|FLOAT NOT NULL|SMALLFLOAT|SMALLFLOAT NOT NULL|DECIMAL|DECIMAL NOT NULL|SERIAL|SERIAL NOT NULL|DATE|DATE NOT NULL|MONEY|MONEY NOT NULL|NULL|DATETIME|DATETIME NOT NULL|BYTE|BYTE NOT NULL|TEXT|TEXT NOT NULL|VARCHAR|VARCHAR NOT NULL|INTERVAL|INTERVAL NOT NULL|NCHAR|NCHAR NOT NULL|NVCHAR|NVCHAR NOT NULL|INT8|INT8 NOT NULL|SERIAL8|SERIAL8 NOT NULL|MULTISET|LIST|ROW|COLLECTION|ROWREF|LVARCHAR|LVARCHAR NOT NULL|CLOB|BLOB|BOOLEAN|BIGINT|BIGSERIAL))\\b"
                },
                {
                    "comment": "SQL Statements and operators",
                    "name": "keyword.other.sql.4gl",
                    "match": "(?i)(?<![\\w_])(load from|unload to|unique|select|insert|update|delete|merge|create|drop|alter|truncate|replace|grant|revoke|connect|disconnect|create\\s+index|drop\\s+index|create\\s+table|drop\\s+table|create\\s+view|drop\\s+view|create\\s+procedure|drop\\s+procedure|create\\s+function|drop\\s+function|create\\s+trigger|drop\\s+trigger|allocate\\s+collection|allocate\\s+row|allocate\\s+descriptor|alter\\s+fragment|alter\\s+access_method|union|union\\s+all|intersect|except|where|from|group\\s+by|having|order\\s+by|order|join|inner\\s+join|left\\s+join|right\\s+join|full\\s+join|cross\\s+join|into\\s+temp|into|values|with|without\\s+defaults|for\\s+update|for\\s+share|using|between|like|in|exists|any|all|distinct|first|rows|and|or|not|is|null|asc|desc)(?![\\w_])"
                },
                {
                    "comment": "Input en forms y auxiliares de display",
                    "name": "support.type.source.4GL",
                    "match": "\\b(?i)(clipped|exit input|on key|key|next|message|end input|exit input|before|after input|after|field|CLEAR FORM|open form|display form|display to|display at|display|input|by|name)\\b"
                },
                
                {
                    "comment": "Transaccionales y de 4gl propios",
                    "name": "support.type.source.4GL",
                    "match": "\\b(?i)(LOCK TABLE|exclusive mode|INTO|EXECUTE|SCROLL|OPEN|FREE|fetch first|WITH HOLD|ROLLBACK WORK|commit work|begin work|close database|database|run|WITHOUT WAITING|continue while|continue foreach|exit while|exit foreach|exit for|fetch|close)\\b"
                },
                {
                    "comment": "Impresion ",
                    "name": "keyword.other.report.4gl",
                    "match": "\\b(?i)(output|left|margin|top|bottom|page|trailer|ascii|format|header|print|column|on every|on everey row|skip|WORDWRAP|right|output to)\\b"
                },
                {
                    "comment": "Variable definitions",
                    "name": "storage.modifier.variable.4gl",
                    "match": "\\b(?i:(prepare|declare|command|end record|record|initialize to|define|message|construct|let|LIKE|globals|cursor for|cursor|output format|OPTIONS|PROMPT|LINE|STATUS|NOTFOUND|FOUND|error|sleep|previous|initialize))\\b"
                },
                {
                    "comment": "Funciones propias y operadores de informix o variables reservadas en 4gl o formularios",
                    "name": "support.function.4gl",
                    "match": "\\b(?i:(SET LOCK MODE TO WAIT|WHENEVER ERROR STOP|WHENEVER ERROR CONTINUE|SQL INTERRUPT ON|DEFER INTERRUPT|current|date|lineno|pageno|space|spaces|fgl_getkey|fgl_getenv|fgl_drawbox|length|year|month|day|mdy|weekday|upshift|downshift))\\b"
                },
                {
                    "comment": "Numeric constants",
                    "name": "constant.numeric.4gl",
                    "match": "(?<![A-Za-z0-9_])-?(\\d+\\.?\\d*|\\.\\d+)([eE][+-]?\\d+)?"
                }
            ]
        },
        "comments": {
            "patterns": [
                {
                    "match": "--.*$",
                    "name": "comment.line.double-dash.4gl"
                },
                {
                    "match": "#.*$",
                    "name": "comment.line.number-sign.4gl"
                },
                {
                    "begin": "\\{",
                    "beginCaptures": {
                        "0": {
                            "name": "punctuation.definition.comment.begin.4gl"
                        }
                    },
                    "end": "\\}",
                    "endCaptures": {
                        "0": {
                            "name": "punctuation.definition.comment.end.4gl"
                        }
                    },
                    "name": "comment.block.braces.4gl"
                }
            ]
        },

        "string_escape": {
            "match": "\\\\.",
            "name": "constant.character.escape.4gl"
        },

        "string_interpolation": {
            "captures": {
                "1": { "name": "punctuation.definition.string.begin.4gl" },
                "3": { "name": "punctuation.definition.string.end.4gl" }
            },
            "match": "(#\\{)([^\\}]*)(\\})",
            "name": "string.interpolated.4gl"
        },

        "strings": {
            "patterns": [
                {
                    "begin": "'",
                    "beginCaptures": {
                        "0": {
                            "name": "punctuation.definition.string.begin.4gl"
                        }
                    },
                    "end": "'",
                    "endCaptures": {
                        "0": { "name": "punctuation.definition.string.end.4gl" }
                    },
                    "name": "string.quoted.single.4gl",
                    "patterns": [
                        { "include": "#string_escape" },
                        {
                            "match": "\\|\\|",
                            "name": "keyword.operator.concatenation.4gl"
                        }
                    ]
                },
                {
                    "begin": "\"",
                    "beginCaptures": {
                        "0": {
                            "name": "punctuation.definition.string.begin.4gl"
                        }
                    },
                    "end": "\"",
                    "endCaptures": {
                        "0": { "name": "punctuation.definition.string.end.4gl" }
                    },
                    "name": "string.quoted.double.4gl",
                    "patterns": [{ "include": "#string_interpolation" }]
                },
                {
                    "begin": "`",
                    "beginCaptures": {
                        "0": {
                            "name": "punctuation.definition.string.begin.4gl"
                        }
                    },
                    "end": "`",
                    "endCaptures": {
                        "0": { "name": "punctuation.definition.string.end.4gl" }
                    },
                    "name": "string.quoted.other.backtick.4gl",
                    "patterns": [{ "include": "#string_escape" }]
                }
            ]
        },
        "function_references": {
            "patterns": [
                {
                    "comment": "Resalta llamadas a funciones definidas, incluso sin CALL y con saltos de lÃ­nea",
                    "match": "\\b([A-Za-z_][A-Za-z0-9_]*)\\b(?:\\s|\\n|\\r)*\\(",
                    "captures": {
                        "1": { "name": "entity.name.function.call.4gl" }
                    }
                }
            ]
        }
    }
}
